<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard â€“ Skin.Me Admin</title>
    <link rel="stylesheet" th:href="@{/css/dashboard.css}">
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.263.0/dist/umd/lucide.min.js"></script>
</head>
<body class="flex min-h-screen bg-gray-100">

<!-- ==================== SIDEBAR ==================== -->
<aside class="w-48 bg-gradient-to-b from-blue-600 to-blue-400 shadow-lg p-6 flex flex-col h-screen rounded-r-xl">
    <h2 class="text-2xl font-bold text-white mb-5 tracking-wider text-center">Skin.Me</h2>

    <nav class="flex flex-col gap-4">
        <a th:href="@{/dashboard}" th:class="${#request.requestURI == '/dashboard'} ? 'bg-sky-200 text-blue-600 font-semibold shadow-lg' : ''"
           class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="layout-dashboard"></i> <span>Dashboard</span>
        </a>

        <a th:href="@{/category-crud}" th:class="${#request.requestURI.startsWith('/category-crud')} ? 'bg-sky-200 text-blue-600 font-semibold shadow-lg' : ''"
           class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="tag"></i> <span>Categories</span>
        </a>

        <a th:href="@{/product-crud}" th:class="${#request.requestURI.startsWith('/product-crud')} ? 'bg-sky-200 text-blue-600 font-semibold shadow-lg' : ''"
           class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="package"></i> <span>Products</span>
        </a>

        <a th:href="@{/order-control}" th:class="${#request.requestURI.startsWith('/order-control')} ? 'bg-sky-200 text-blue-600 font-semibold shadow-lg' : ''"
           class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="clipboard-list"></i> <span>Orders</span>
        </a>

        <a th:href="@{/user-control}" th:class="${#request.requestURI.startsWith('/user-control')} ? 'bg-sky-200 text-blue-600 font-semibold shadow-lg' : ''"
           class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="users"></i> <span>Users</span>
        </a>

        <a href="/" class="flex items-center gap-3 p-5 rounded-lg transition-all text-white hover:bg-sky-500 hover:text-blue-600">
            <i data-lucide="home"></i> <span>Homepage</span>
        </a>
    </nav>

    <div class="mt-auto pt-6">
        <form th:action="@{/logout}" method="post" class="inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit"
                    class="flex items-center gap-3 p-3 rounded-lg w-full bg-white text-red-600 font-semibold hover:shadow-lg transition">
                <i data-lucide="log-out"></i> Logout
            </button>
        </form>
    </div>
</aside>

<!-- ==================== MAIN CONTENT ==================== -->
<main class="flex-1 p-8 space-y-8 overflow-y-auto">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Dashboard Overview</h1>
        <div th:text="${#authentication?.name}">Guest</div>
    </div>

    <!-- SUCCESS / ERROR MESSAGES -->
    <div th:if="${param.success}" class="p-4 bg-green-100 text-green-800 rounded-lg text-center">
        Operation successful!
    </div>
    <div th:if="${error}" class="p-4 bg-red-100 text-red-800 rounded-lg text-center" th:text="${error}"></div>

    <!-- ==================== SUMMARY CARDS ==================== -->
    <div class="grid grid-cols-1 md:grid-cols-3 xl:grid-cols-4 gap-6">
        <a th:href="@{/sales}" class="cursor-pointer">
            <div class="p-6 bg-green-50 rounded-2xl shadow flex items-center gap-4">
                <i data-lucide="dollar-sign" class="w-10 h-10 text-green-600"></i>
                <div>
                    <div class="text-sm text-gray-600">Total Revenue</div>
                    <div class="text-2xl font-bold" th:text="'$' + ${#numbers.formatDecimal(totalRevenue,1,2)}"></div>
                </div>
            </div>
        </a>

        <div class="p-6 bg-blue-50 rounded-2xl shadow flex items-center gap-4">
            <i data-lucide="package" class="w-10 h-10 text-blue-600"></i>
            <div>
                <div class="text-sm text-gray-600">Products Sold</div>
                <div class="text-2xl font-bold" th:text="${totalQuantity}"></div>
            </div>
        </div>

        <div class="p-6 bg-orange-50 rounded-2xl shadow flex items-center gap-4">
            <i data-lucide="trending-up" class="w-10 h-10 text-orange-600"></i>
            <div>
                <div class="text-sm text-gray-600">Total Products</div>
                <div class="text-2xl font-bold" th:text="${totalProducts}"></div>
            </div>
        </div>

        <div class="p-6 bg-purple-50 rounded-2xl shadow flex items-center gap-4">
            <i data-lucide="shopping-cart" class="w-10 h-10 text-purple-600"></i>
            <div>
                <div class="text-sm text-gray-600">Pending Orders</div>
                <div class="text-2xl font-bold" th:text="${pendingOrders}"></div>
            </div>
        </div>
    </div>

    <!-- ==================== PRODUCT TABLE ==================== -->
    <section class="bg-white shadow rounded-2xl p-6">
        <h2 class="text-xl font-semibold mb-4 text-gray-800">Product Summary</h2>

        <div th:if="${salesRecords == null or #lists.isEmpty(salesRecords)}"
             class="text-gray-600">No product sales found.</div>

        <div th:unless="${salesRecords == null or #lists.isEmpty(salesRecords)}"
             class="overflow-x-auto rounded-lg border border-gray-200">
            <table class="min-w-full text-sm text-gray-700">
                <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                <tr>
                    <th class="px-6 py-3 text-left">Product ID</th>
                    <th class="px-6 py-3 text-left">Name</th>
                    <th class="px-6 py-3 text-left">Price</th>
                    <th class="px-6 py-3 text-left">Qty Sold</th>
                    <th class="px-6 py-3 text-left">Total Sale</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p : ${currentProducts}" class="hover:bg-gray-50 border-t">
                    <td class="px-6 py-4" th:text="${p.productId}"></td>
                    <td class="px-6 py-4 font-medium" th:text="${p.name}"></td>
                    <td class="px-6 py-4" th:text="'$' + ${#numbers.formatDecimal(p.price,1,2)}"></td>
                    <td class="px-6 py-4" th:text="${p.quantitySold}"></td>
                    <td class="px-6 py-4 font-semibold"
                        th:text="'$' + ${#numbers.formatDecimal(p.price * p.quantitySold,1,2)}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- PAGINATION -->
        <div th:if="${totalPages > 1}" class="flex justify-center mt-6 gap-2" id="pagination">
            <form id="pageForm" th:action="@{/dashboard}" method="get" class="hidden">
                <input type="hidden" id="pageInput" name="page" />
            </form>
            <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                <button type="button" data-page="${i}"
                        th:classappend="${currentPage == i} ? 'bg-blue-600 text-white' : 'bg-gray-200 hover:bg-gray-300'"
                        class="px-3 py-1 rounded-lg text-sm font-medium transition">
                    <span th:text="${i}"></span>
                </button>
            </th:block>
        </div>
    </section>
</main>

<script th:src="@{/js/dashboard.js}"></script>
<script>lucide.createIcons();</script>
</body>
</html>
