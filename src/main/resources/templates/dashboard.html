<!doctype html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="en"
  th:replace="app :: layout(~{::main}, ~{::style}, ~{::script})"
>
  <style>
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary:hover { background: var(--primary-dark); box-shadow: var(--shadow); color: white; }
    .action-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
  </style>

  <main class="main-content">
    <div class="page-header">
      <div class="d-flex justify-content-between align-items-center">
        <h1 class="mb-0"><i class="bi bi-speedometer2"></i> Admin Dashboard</h1>
        <button class="btn btn-light" onclick="logout()">
          <i class="bi bi-box-arrow-right"></i> Logout
        </button>
      </div>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-circle"></i> <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div class="dashboard-grid stats-row">
      <div class="stat-card">
        <div class="stat-icon"><i class="bi bi-box2"></i></div>
        <div class="stat-value" th:text="${totalProducts ?: 0}">0</div>
        <div class="stat-label">Total Products</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="bi bi-cart-check"></i></div>
        <div class="stat-value" th:text="${totalOrders ?: 0}">0</div>
        <div class="stat-label">Total Orders</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="bi bi-people"></i></div>
        <div class="stat-value" th:text="${totalUsers ?: 0}">0</div>
        <div class="stat-label">Total Users</div>
      </div>

      <div class="stat-card">
        <div class="stat-icon"><i class="bi bi-graph-up"></i></div>
        <div class="stat-value" th:text="'$' + ${#numbers.formatDecimal(totalRevenue ?: 0, 1, 2)}">$0.00</div>
        <div class="stat-label">Total Revenue</div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="content-section">
      <h2 class="section-title"><i class="bi bi-lightning-fill"></i> Quick Actions</h2>
      <div class="action-buttons">
        <a href="/views/categories" class="btn-primary"> <i class="bi bi-tags"></i> View Categories </a>
        <a href="/views/products" class="btn-primary"> <i class="bi bi-box-seam"></i> View Products </a>
        <a href="/views/orders" class="btn-primary"> <i class="bi bi-bag-check"></i> View Orders </a>
        <a href="/views/payments" class="btn-primary"> <i class="bi bi-receipt"></i> View Payments </a>
      </div>
    </div>

    <!-- Welcome Message -->
    <div class="content-section" style="margin-top: 30px; margin-bottom: 30px">
      <h2 class="section-title"><i class="bi bi-hand-thumbs-up"></i> Welcome to SkinMe Admin Panel</h2>
      <p style="color: #666; line-height: 1.6">
        This is your central hub for managing all skincare products, orders, and customer interactions. Use
        the navigation menu on the left to access different sections of the application.
      </p>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
  <script src="/js/websocket-client.js"></script>
  <script>
    function logout() {
      if (confirm("Are you sure you want to logout?")) {
        window.location.href = "/logout";
      }
    }

    // Initialize WebSocket for notifications
    document.addEventListener("DOMContentLoaded", () => {
      if (typeof webSocketClient !== "undefined") {
        webSocketClient.connect(() => {
          webSocketClient.subscribeToNotifications((notification) => {
            showNotification(notification);
          });
        });
      }
    });

    function showNotification(notification) {
      // Create a simple toast notification
      const toast = document.createElement("div");
      toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                max-width: 400px;
            `;
      toast.innerHTML = `
                <div style="font-weight: 600; color: #333;">${notification.title}</div>
                <div style="color: #666; margin-top: 5px;">${notification.message}</div>
            `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 5000);
    }
  </script>
</html>
